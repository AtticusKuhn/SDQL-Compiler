flowchart TB
    subgraph "Lean Elaboration Time"
        Q["Quasiquoter invoked"] --> E1["elabSDQLToLoad"]
        Q --> E2["elabTy"]
        E1 --> E3["processLoadTerm2"]
        E2 --> E3
        E3 -->|"Type error"| ERR["Elaboration error with source locations"]
        E3 -->|"Success"| OK["Lean term calling loadTermToSProg2"]
    end

    subgraph "Lean Runtime"
        OK --> R1["loadTermToSProg2 -> SProg2"]
        R1 --> R2["ToCore2.trProg2 -> Prog2"]
        R2 --> R3["applyOptimisations -> Prog2"]
        R3 --> R4["renderRustProg2Shown -> Rust source"]
    end

    subgraph "System"
        R4 --> R5["Write .rs file"]
        R5 --> R6["rustc"]
        R6 --> R7["Execute binary"]
    end

    style Q fill:#e1f5fe,stroke:#0288d1
    style ERR fill:#ffcdd2,stroke:#c62828
    style OK fill:#c8e6c9,stroke:#2e7d32
    style R4 fill:#e8f5e9,stroke:#388e3c
